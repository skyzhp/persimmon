webpackJsonp([7],{388:function(t,e,a){"use strict";function o(t){a(463)}Object.defineProperty(e,"__esModule",{value:!0});var n=a(410),r=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,function(){return n[t]})}(i);var l=a(465),s=a.n(l),c=a(6),d=o,m=c(r.a,s.a,!1,d,null,null);e.default=m.exports},410:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a(19),n=function(t){return t&&t.__esModule?t:{default:t}}(o);e.default={data:function(){var t=this;return{listData:[],categorys:[],myForm:{id:0,category_name:"",category_flag:"",category_description:"",category_parent:0},myRules:{category_name:[{required:!0,type:"string",title:"请填写分类名称",trigger:"blur"}],category_flag:[{required:!0,type:"string",title:"请填写分类别名",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+$/,title:"只允许英文或者拼音,横杠(-),下划线(_)",trigger:"blur"}]},editFormVisible:!1,editFormLoading:!1,listLoading:!1,myFormTitle:"编辑",checkedAll:[],tableColumns:[{type:"selection",width:60,align:"center"},{title:"分类名称",key:"category_name"},{title:"分类别名",key:"category_flag"},{title:"日期",key:"created_at",render:function(t,e){return t("span",n.default.timeFormat(e.row.created_at))}},{title:"操作",key:"action",width:150,align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.handleEdit(a.row)}}},"编辑"),e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.handleDistory("one",a.row)}}},"删除")])}}]}},methods:{getData:function(){var t=this;t.listLoading=!0,n.default.ajax.get("/backend/categories",{params:{page:1,rows:20}}).then(function(e){var a=e.data;200==a.status?(t.listData=a.list.data,t.listLoading=!1):t.$Notice.warning({title:"数据获取失败",duration:3e3})}).catch(function(t){console.log(t)})},handleCreate:function(){var t=this;t.myFormTitle="新增",t.myForm.id=0,t.editFormVisible=!0,t.setTopCategorys()},handleEdit:function(t){var e=this;e.setTopCategorys(),e.editFormLoading=!0,e.myFormTitle="编辑",e.editFormVisible=!0,n.default.ajax.get("/backend/categories/"+t.id).then(function(t){var a=t.data;0!=a?e.myForm=a.item:e.$Notice.warning({title:"数据获取失败",desc:""}),e.editFormLoading=!1}).catch(function(t){console.log(t),e.editFormLoading=!1})},handleDistory:function(t,e){var a=this,o={};switch(t){case"one":if(parseInt(e.id)<=0)return a.$Notice.warning({title:"请选择需要删除的数据",desc:""}),!1;o={ids:[e.id]};break;case"multi":var r=n.default.getIdByArr(a.checkedAll);if(r.length<=0)return a.$Notice.warning({title:"请选择需要删除的数据",desc:""}),!1;o={ids:r}}a.$Modal.confirm({title:"确认删除选中的记录吗?",content:"<p>您确认删除选中的记录吗?</p>",onOk:function(){a.listLoading=!0,n.default.ajax.post("/backend/categories/destroy",n.default.stringify(o)).then(function(o){a.listLoading=!1;var r=o.data;if(a.$Notice.warning({title:200==r.status?"删除成功":"删除失败",desc:""}),"one"==t)n.default.removeByValue(a.listData,e.id);else for(var i in a.checkedAll)n.default.removeByValue(a.listData,a.checkedAll[i].id)}).catch(function(t){console.log(t)})},onCancel:function(){a.listLoading=!1}})},submitMyForm:function(){var t=this;t.$refs.myForm.validate(function(e){if(!e)return console.log("myForm valid error."),!1;t.myForm.id>0?n.default.ajax.put("/backend/categories/update",t.myForm).then(function(e){var a=e.data;t.$Notice.open({title:200==a.status?"编辑成功":"编辑失败",desc:""}),200==a.status&&(t.closeForm("myForm"),t.getData())}).catch(function(t){console.log(t)}):n.default.ajax.post("/backend/categories/store",t.myForm).then(function(e){var a=e.data;200==a.status&&t.closeForm("myForm"),t.$Notice.open({title:200==a.status?"新增成功":"新增失败",desc:""}),t.getData()}).catch(function(e){if(e.response){if(501==e.response.status)for(var a in e.response.data)t.$Notice.warning({title:"警告",desc:e.response.data[a][0]})}else console.log(e)})})},closeForm:function(){this.editFormVisible=!1,this.$refs.myForm.resetFields(),this.myForm={id:0,category_name:"",category_flag:"",category_description:"",category_parent:0},console.log("closeForm")},setTopCategorys:function(){var t=this.listData.concat();t.splice(0,0,{id:0,category_name:"顶级分类",hidden:!0,category_parent:0}),this.categorys=t},selectRow:function(t){this.checkedAll=t},selectAll:function(t){this.checkedAll=t},translateWords:function(t){var e=this,a=e.myForm.category_name;if(null!=a.match(/\w+/g)&&(e.myForm.flag=a),null==a||""==a)return!1;n.default.ajax.get("/backend/utils/fanyi/"+a).then(function(t){var a=t.data;200==a.status&&(e.myForm.category_flag=a.item)}).catch(function(t){console.log(t)})}},mounted:function(){this.getData()}}},463:function(t,e,a){var o=a(464);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a(23)("369119e3",o,!0,{})},464:function(t,e,a){e=t.exports=a(22)(!1),e.push([t.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},465:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pit-content"},[a("div",{staticClass:"pit-action-btn"},[a("Button",{attrs:{type:"primary",icon:"plus"},on:{click:t.handleCreate}},[t._v("新增")]),t._v(" "),a("Button",{attrs:{type:"primary",icon:"delete"},on:{click:function(e){t.handleDistory("multi",{})}}},[t._v("删除")])],1),t._v(" "),a("div",{staticClass:"data-list"},[a("Table",{attrs:{loading:t.listLoading,columns:t.tableColumns,data:t.listData,stripe:""},on:{"on-select":t.selectRow,"on-select-all":t.selectAll}})],1),t._v(" "),a("Modal",{attrs:{title:t.myFormTitle},on:{"on-ok":t.submitMyForm,"on-cancel":t.closeForm},model:{value:t.editFormVisible,callback:function(e){t.editFormVisible=e},expression:"editFormVisible"}},[a("div",{staticClass:"pit-dialog-edit-form"},[a("Form",{ref:"myForm",staticClass:"myForm",staticStyle:{width:"90%"},attrs:{rules:t.myRules,model:t.myForm,"label-position":"right","label-width":100}},[a("FormItem",{attrs:{label:"分类名称",prop:"category_name"}},[a("Input",{attrs:{"auto-complete":"off"},on:{"on-blur":t.translateWords,"on-enter":t.translateWords},model:{value:t.myForm.category_name,callback:function(e){t.$set(t.myForm,"category_name",e)},expression:"myForm.category_name"}})],1),t._v(" "),a("FormItem",{attrs:{label:"分类别名",prop:"category_flag"}},[a("Input",{attrs:{"auto-complete":"off"},model:{value:t.myForm.category_flag,callback:function(e){t.$set(t.myForm,"category_flag",e)},expression:"myForm.category_flag"}})],1),t._v(" "),a("FormItem",{attrs:{label:"分类描述"}},[a("Input",{attrs:{type:"textarea"},model:{value:t.myForm.category_description,callback:function(e){t.$set(t.myForm,"category_description",e)},expression:"myForm.category_description"}})],1),t._v(" "),a("FormItem",{attrs:{label:"父分类"}},[a("Select",{attrs:{placeholder:"请选择父分类"},model:{value:t.myForm.category_parent,callback:function(e){t.$set(t.myForm,"category_parent",e)},expression:"myForm.category_parent"}},t._l(t.categorys,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.category_name)+"\n                        ")])}))],1),t._v(" "),t.myForm.id?a("FormItem",[a("Input",{staticStyle:{display:"none"},model:{value:t.myForm.id,callback:function(e){t.$set(t.myForm,"id",e)},expression:"myForm.id"}})],1):t._e()],1),t._v(" "),t.editFormLoading?a("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)])],1)},n=[],r={render:o,staticRenderFns:n};e.default=r}});